{% extends "base.html" %}
{% block title_extra %} â€” Map{% endblock %}
{% block head %}
<link href="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.3/mapbox-gl-geocoder.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.3/mapbox-gl-geocoder.min.js"></script>
{% endblock %}
{% block content %}
<div class="row g-0" style="height: calc(100vh - 70px);">
    <div class="col" id="map-col" style="position: relative;">
        <div id="map" style="height: 100%;"></div>
        <!-- Bottom Pin Selector Bar -->
        <div id="pin-bar">
            <!-- populated by JS -->
        </div>
    </div>
    <div id="side-panel" class="border-start" style="width: 0; overflow: hidden; transition: width 0.2s; height: calc(100vh - 70px);">
        <div class="p-3" style="width: 320px;">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">Customer Info</h6>
                <button type="button" class="btn-close" id="btn-close-panel"></button>
            </div>
            <hr class="mt-1 mb-2">
            <form id="lead-form" autocomplete="off">
                <input type="hidden" id="lead-lat">
                <input type="hidden" id="lead-lon">
                <input type="hidden" id="lead-visit-id">
                <input type="hidden" id="lead-lead-id">
                <div class="mb-2">
                    <label class="form-label small mb-0">Address</label>
                    <input type="text" class="form-control form-control-sm" id="lead-street" placeholder="Street" readonly>
                </div>
                <div class="row mb-2">
                    <div class="col-6"><input type="text" class="form-control form-control-sm" id="lead-city" placeholder="City" readonly></div>
                    <div class="col-3"><input type="text" class="form-control form-control-sm" id="lead-state" placeholder="ST" value="WA" readonly></div>
                    <div class="col-3"><input type="text" class="form-control form-control-sm" id="lead-zip" placeholder="Zip" readonly></div>
                </div>
                <div class="mb-2">
                    <label class="form-label small mb-0">Designation</label>
                    <div id="desig-dropdown" class="desig-dropdown">
                        <div id="desig-selected" class="desig-selected"></div>
                        <div id="desig-options" class="desig-options"></div>
                    </div>
                    <input type="hidden" id="lead-designation">
                </div>
                <hr class="my-2">
                <div class="row mb-2">
                    <div class="col"><input type="text" class="form-control form-control-sm" id="lead-first" placeholder="First Name *"></div>
                    <div class="col"><input type="text" class="form-control form-control-sm" id="lead-last" placeholder="Last Name *"></div>
                </div>
                <div class="mb-2">
                    <input type="email" class="form-control form-control-sm" id="lead-email" placeholder="Email">
                </div>
                <div class="mb-2">
                    <input type="tel" class="form-control form-control-sm" id="lead-phone" placeholder="Phone">
                </div>
                <hr class="my-2">
                <div class="mb-2">
                    <label class="form-label small mb-1">Service Plan</label>
                    <select class="form-select form-select-sm" id="lead-service-plan">
                        <option value="">Select plan...</option>
                        <!-- populated from UISP -->
                    </select>
                </div>
                <hr class="my-2">
                <textarea class="form-control form-control-sm mb-2" id="lead-notes" rows="2" placeholder="Notes"></textarea>
                <button type="button" class="btn btn-primary btn-sm w-100 mb-1" id="btn-save-lead">Save Lead</button>
                <button type="button" class="btn btn-outline-danger btn-sm w-100 mb-1" id="btn-delete-visit">Delete Pin</button>
                <div id="lead-save-status" class="small text-center mt-1"></div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>const MAPBOX_TOKEN = "{{ mapbox_token }}";</script>
<script src="{{ url_for('static', filename='js/map.js') }}?v={{ range(10000,99999) | random }}"></script>
<script src="{{ url_for('static', filename='js/lead_form.js') }}?v={{ range(10000,99999) | random }}"></script>
{% endblock %}
